<!-- blogpost/assets/realtime-flow.svg -->
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="520" viewBox="0 0 1200 520" role="img" aria-label="Realtime API flow diagram">
  <defs>
    <style>
      text { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; font-size: 18px; }
      .box { fill: #ffffff; stroke: #111827; stroke-width: 2; rx: 14; }
      .title { font-size: 20px; font-weight: 700; }
      .muted { fill: #374151; font-size: 16px; }
      .arrow { stroke: #111827; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead); }
      .chip { fill: #f3f4f6; stroke: #111827; stroke-width: 1.5; rx: 10; }
    </style>
    <marker id="arrowhead" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 Z" fill="#111827"/>
    </marker>
  </defs>

  <!-- Boxes -->
  <rect class="box" x="60" y="90" width="320" height="340" rx="16"/>
  <rect class="box" x="440" y="90" width="320" height="340" rx="16"/>
  <rect class="box" x="820" y="90" width="320" height="340" rx="16"/>

  <!-- Left: Client -->
  <text x="90" y="130" class="title">Browser client</text>
  <text x="90" y="165" class="muted">• Mic → WebRTC audio track</text>
  <text x="90" y="195" class="muted">• DataChannel: JSON events</text>
  <text x="90" y="225" class="muted">• UI: custom instructions</text>
  <text x="90" y="255" class="muted">• Handles interruptions</text>

  <rect class="chip" x="90" y="300" width="260" height="44" rx="12"/>
  <text x="105" y="329">RTCPeerConnection</text>

  <rect class="chip" x="90" y="360" width="260" height="44" rx="12"/>
  <text x="105" y="389">RTCDataChannel: oai-events</text>

  <!-- Middle: Your server -->
  <text x="470" y="130" class="title">Rubric server</text>
  <text x="470" y="165" class="muted">• Holds real API key</text>
  <text x="470" y="195" class="muted">• Mints client secrets</text>
  <text x="470" y="225" class="muted">• Zod-validated boundary</text>
  <text x="470" y="255" class="muted">• Optional tools/business logic</text>

  <rect class="chip" x="470" y="300" width="260" height="44" rx="12"/>
  <text x="485" y="329">POST /v1/realtime/client_secrets</text>

  <!-- Right: OpenAI -->
  <text x="850" y="130" class="title">OpenAI Realtime API</text>
  <text x="850" y="165" class="muted">• WebRTC call creation</text>
  <text x="850" y="195" class="muted">• Speech-to-speech model</text>
  <text x="850" y="225" class="muted">• Server events stream</text>
  <text x="850" y="255" class="muted">• Turn detection / VAD</text>

  <rect class="chip" x="850" y="300" width="260" height="44" rx="12"/>
  <text x="865" y="329">POST /v1/realtime/calls (SDP)</text>

  <rect class="chip" x="850" y="360" width="260" height="44" rx="12"/>
  <text x="865" y="389">Events: session.update / response.*</text>

  <!-- Arrows -->
  <path class="arrow" d="M 380 170 C 410 170, 410 170, 440 170"/>
  <text x="390" y="155" class="muted">fetch secret</text>

  <path class="arrow" d="M 760 170 C 790 170, 790 170, 820 170"/>
  <text x="770" y="155" class="muted">mint</text>

  <path class="arrow" d="M 380 330 C 600 330, 600 330, 820 330"/>
  <text x="470" y="315" class="muted">SDP offer → answer</text>

  <path class="arrow" d="M 820 395 C 600 395, 600 395, 380 395"/>
  <text x="560" y="380" class="muted">audio + events</text>

  <!-- Footer note -->
  <text x="60" y="485" class="muted">
    Tip: keep the client secret ephemeral; keep tools/business logic on the server; drive behaviors with session.update.
  </text>
</svg>
